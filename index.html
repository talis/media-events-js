<html>
    <head>
        <script src="videoAnalytics.js"></script>
    </head>
    <body>
        <video id="video" controls preload="none" mediagroup="myVideoGroup" poster="http://media.w3.org/2010/05/sintel/poster.png">
            <source id="mp4" src="http://media.w3.org/2010/05/sintel/trailer.mp4" type="video/mp4">
            <source id="webm" src="http://media.w3.org/2010/05/sintel/trailer.webm" type="video/webm">
            <source id="ogv" src="http://media.w3.org/2010/05/sintel/trailer.ogv" type="video/ogg">
            <p>Your user agent does not support the HTML5 Video element.</p>
        </video>
        <script>
            var media = document.getElementById('video');
            var timeTracker = new VideoAnalytics();

            function flushEvent(tickEvents) {
                if(Array.isArray(tickEvents) === false) {
                    return;
                }
              
                for(x = 0; x < tickEvents.length; x++) {
                    console.info(JSON.stringify(tickEvents[x]));
                }
            }

            media.addEventListener("timeupdate", function() {
                if(!media.paused && !media.seeking) {
                    flushEvent(timeTracker.tick(media.currentTime * 1000));
                }
            });

            media.addEventListener("pause", function() {
                if(media.ended !== true && media.seeking !== true) {
                    flushEvent(timeTracker.pause());
                }
            });

            media.addEventListener("ended", function() {
                flushEvent(timeTracker.end(media.currentTime * 1000));
                //timeTracker = new VideoAnalytics();
            });
        </script>
    </body>
</html>
